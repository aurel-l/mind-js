"use strict";!function(){var a=void 0,b=void 0,c=void 0;Polymer({ready:function(){a=document.querySelector("mindmap-manager")},attached:function(){var d=this;a.load(this.key).then(function(a){function e(){m.attr("cx",function(a){return a.x=Math.max(5,Math.min(o-5,a.x))}).attr("cy",function(a){return a.y=Math.max(5,Math.min(p-5,a.y))}),l.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),m.attr("transform",function(a){return"translate("+a.x+", "+a.y+")"})}function f(a){var b=CoreStyle.g.theme.hue;return a.fixed?d3.hsl((b+160)%360,.8,.4):a.children?a._children?d3.hsl(b,.5,.4):d3.hsl(b,.8,.4):d3.hsl((b+200)%360,.5,.4)}function g(a){event.defaultPrevented||(a.children?(a._children=a.children,a.children=null):(a.children=a._children,a._children=null),i())}function h(a){function b(a){a.children&&a.children.forEach(b),a.id=++d,c.push(a)}var c=[],d=0;return j=a,j.fixed=!0,j.x=o/2,j.y=p/2,b(a),c}function i(){var b=h(a.data.root),c=d3.layout.tree().links(b);q.nodes(b).links(c).start(),l=l.data(c,function(a){return a.target.title}),l.exit().remove(),l.enter().insert("line",".node").attr("class","link").attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),m=m.data(b,function(a){return a.title}).style("fill",f),m.exit().remove();var d=m.enter().append("g").attr("class","node").call(q.drag);d.append("circle").attr("r",function(a){return Math.sqrt(40*(a.children?a.children.length+1:1))}).style("fill",f).on("click",g),d.append("text").attr("dx",function(a){return Math.sqrt(40*(a.children?a.children.length+1:1))}).text(function(a){return a.title}).style("fill",f).on("click",t)}console.log(a),b=a;var j,k=d3.select(d.$.svg),l=k.selectAll(".link"),m=k.selectAll(".node"),n=d.$.svg.getBoundingClientRect(),o=n.width,p=n.height,q=d3.layout.force().gravity(.01).charge(function(a){return-300*(a.children?a.children.length+1:1)}).linkDistance(function(a){return 3*(a.children?a.children.length+1:1)}).size([o,p]).on("tick",e),r={images:{png:!0,jpg:!0,jpeg:!0,gif:!0,bmp:!0,webp:!0,apng:!0,svg:!0,ico:!0},videos:{ogg:!0,ogv:!0,ogm:!0,webm:!0,mp4:!0},audios:{mp3:!0,wav:!0}},s=function(a,b){return new Promise(function(c,d){var e=document.createElement("div");switch(e.setAttribute("vertical",!0),e.setAttribute("layout",!0),b){case"text":e.innerText=a;break;case"url":var f=document.createElement("a");f.target="_blank",f.href=a;var g=document.createElement("paper-icon-button");g.icon="link",f.appendChild(g),e.appendChild(f);var h=a.split(".").pop().toLowerCase();if(r.images[h]){var i=document.createElement("img");i.src=a,e.appendChild(i)}else if(r.videos[h]){var j=document.createElement("video");j.controls=!0,j.src=a,e.appendChild(j)}else if(r.audios[h]){var k=document.createElement("audio");k.controls=!0,k.src=a,e.appendChild(k)}else f.innerText=a;break;default:e=null}e?c(e):d("unsupported type")})},t=function(a){event.defaultPrevented||s(a.content.data,a.content.typeContent).then(function(b){d.$.content.heading=a.title,d.$.content.replaceChild(b,d.$.content.firstElementChild),d.$.content.mindmapNode=a,d.$.content.toggle()})};c=i,i()})},"delete":function(a,d,e){var f=e.parentElement.mindmapNode,g=function(a){if(a.children){var b=a.children.indexOf(f);b>-1&&a.children.splice(b,1),a.children.forEach(g)}};g(b.data.root),c()},addChild:function(a,b,d){var e=d.parentElement.mindmapNode;e.children||(e.children=[]),console.log(e.children),e.children.push({title:"new node",content:{data:"new node content",typeContent:"text"}}),console.log(e.children),c()}})}();